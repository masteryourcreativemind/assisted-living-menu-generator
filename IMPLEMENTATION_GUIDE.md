# ASSISTED LIVING MENU GENERATOR - IMPLEMENTATION GUIDE

## PROJECT AUDIT & CONVERSION SUMMARY

### Original State (HTML Version)
- ❌ Static HTML file (1343 lines)
- ❌ Client-side only - all data hardcoded
- ❌ No persistence layer
- ❌ Minimal SEO
- ❌ No proper structure or maintainability
- ❌ Recipe database embedded in JavaScript

### Current State (PHP Version 2.0)
✅ **Dynamic PHP Application**
- Professional MVC-style architecture
- Server-side menu generation logic
- Modular class-based design
- Database-ready with JSON fallback
- Full SEO optimization
- Comprehensive recipe database management
- Scalable and maintainable codebase

---

## KEY IMPROVEMENTS

### 1. Architecture Conversion
```
Before: Single HTML file with 50KB+ JavaScript
After:  Modular PHP application with:
        - Entry point (index.php)
        - Configuration layer
        - Class-based business logic
        - Template separation
        - Data layer abstraction
```

### 2. SEO Enhancements
✅ Meta tags optimization
✅ Open Graph protocol
✅ Twitter Card integration
✅ JSON-LD structured data
✅ Breadcrumb navigation
✅ Canonical URLs
✅ Robots meta tags
✅ Mobile viewport configuration
✅ Accessibility features

### 3. Dynamic Features
✅ Database abstraction layer (MySQL + JSON fallback)
✅ Menu generation algorithms
✅ Recipe management system
✅ AJAX-based UI updates
✅ Multiple export formats (Text, CSV, JSON, PDF-ready)
✅ Session management
✅ Error handling

### 4. Security Enhancements
✅ Input sanitization
✅ Output escaping
✅ Security headers (.htaccess)
✅ HTTPS enforcement
✅ Protected configuration files
✅ Database credential protection
✅ XSS prevention
✅ SQL injection prevention

---

## MENU GENERATION ALGORITHM

### How It Works

1. **Week Selection**
   - User selects week number and year
   - Application validates date range

2. **Day Loop (7 iterations)**
   - For each day of the week:
     - Select random breakfast from appropriate pool
     - Select random soup from soups collection
     - Select random special from specials collection
     - Select random salad from salads collection
     - Select random burger from burgers collection
   
3. **Serving Size Scaling**
   - All recipe quantities are base measurements
   - Ingredients are proportionally scaled to serving size
   - Maintains nutritional ratios

4. **Menu Persistence**
   - Menu stored in session
   - Can be regenerated by day
   - Exportable in multiple formats

### Recipe Categories

```
Breakfast:
├── Monday-Friday (15 items)
├── Saturday (5 items)
└── Sunday (5 items)

Soups (25+ items):
├── Chicken Noodle
├── Tomato Basil
├── Lentil
├── Butternut Squash
└── ... and more

Specials (60+ items):
├── Fish (Salmon, Tilapia, Flounder, Cod, Halibut, etc.)
├── Poultry (Chicken, Turkey)
├── Beef (Stroganoff, Bourguignon, Medallions, etc.)
├── Lamb & Veal
└── Seafood (Scallops, Shrimp, Crab, Lobster, Mussels)

Salads (3+ items):
├── Grilled Chicken Caesar
├── Garden Vegetable
└── Tuna Salad

Burgers (3+ items):
├── Lean Beef Burger
├── Turkey Burger
└── Veggie Burger
```

---

## SUBDOMAIN CONFIGURATION

### For allaround.work/tools/menugen

#### Option 1: Subdomain (Recommended for SEO)
```
URL: https://tools.allaround.work
DNS: CNAME record pointing to main domain
Apache: Separate VirtualHost configuration
Benefits: Better SEO, cleaner URLs, easier management
```

#### Option 2: Subdirectory (If subdomain not available)
```
URL: https://allaround.work/tools/menugen
Requires: Proper .htaccess URL rewriting
PHP: Adjust APP_URL constant in config
```

### DNS Setup
```
Name:   tools
Type:   CNAME
Value:  allaround.work

OR (for A record):
Name:   tools
Type:   A
Value:  [Your Server IP]
```

### Apache Configuration
See DEPLOYMENT.md for complete VirtualHost setup

---

## EXPORT FUNCTIONALITY

### Text Format
- Human-readable format
- Line-by-line recipe with ingredients and instructions
- Notes included
- Suitable for printing or email

### CSV Format
- Spreadsheet-compatible
- Columns: Day, Item Type, Name, Description, Ingredients, Instructions, Notes
- Import into Excel, Google Sheets, etc.
- Proper escaping for special characters

### JSON Format
- Machine-readable structured data
- Complete menu object with all fields
- Perfect for API integration
- Easy to parse and transform

### PDF Format
- Professional printable document
- Requires TCPDF or mPDF integration
- Currently exports as text (ready for PDF library)

---

## INSTALLATION CHECKLIST

- [ ] Create project directory structure
- [ ] Upload all files to web server
- [ ] Set proper file permissions
- [ ] Configure .env file with database credentials
- [ ] Create data directory for JSON storage
- [ ] Set up MySQL database (optional)
- [ ] Configure SSL certificate (HTTPS)
- [ ] Test menu generation functionality
- [ ] Verify export functionality
- [ ] Test on mobile devices
- [ ] Verify SEO metadata with SEO tools
- [ ] Set up automated backups
- [ ] Configure monitoring/alerts
- [ ] Document custom configurations

---

## USAGE WORKFLOW

### For End Users (Facility Staff)

1. **Access Application**
   - Navigate to https://allaround.work/tools/menugen

2. **Generate Menu**
   - Select desired week
   - Choose serving size (10-100 residents)
   - Click "Generate Full Week Menu"

3. **Review & Modify**
   - Review all daily menus
   - Use "Regenerate Single Day" for any changes
   - Verify ingredients and instructions

4. **Export/Print**
   - Export as preferred format (Text, CSV, JSON)
   - Or print directly to PDF
   - Share with kitchen staff

### For Administrators

1. **Recipe Management**
   - Edit RecipeDatabase.php to add/modify recipes
   - Update config.php for facility settings
   - Manage dietary restrictions

2. **Monitoring**
   - Check error logs regularly
   - Monitor database performance
   - Track export statistics

3. **Maintenance**
   - Regular database backups
   - Update PHP dependencies
   - Review security logs

---

## PERFORMANCE METRICS

### Loading Speed Targets
- Page Load: < 2 seconds
- Menu Generation: < 1 second
- Export: < 3 seconds

### Database Queries
- Single menu generation: 1-3 queries (if using DB)
- No N+1 query problems
- Recipe retrieval: O(1) random access

### Caching Strategy
- Browser caching enabled for static assets
- 1-month cache for images, CSS, JS
- 1-day cache for HTML
- No caching for JSON API responses

---

## RECIPE MANAGEMENT

### Adding New Recipe

1. **Edit RecipeDatabase.php**
```php
private function getDefaultRecipes() {
    return [
        'soups' => [
            [
                'name' => 'New Soup Name',
                'description' => 'Description',
                'ingredients' => [ ... ],
                'notes' => 'Preparation notes'
            ],
            // ... more recipes
        ]
    ];
}
```

2. **Reload from Database**
   - If using MySQL, recipes load from table
   - If using JSON fallback, recipes load from data/recipes.json

### Recipe Fields

```php
[
    'name' => 'Recipe Name',                    // Required
    'description' => 'Brief description',       // Required
    'ingredients' => [                          // Required
        'Item - quantity',
        'Item - quantity',
        // ...
    ],
    'instructions' => [                         // Optional, for specials
        'Step 1',
        'Step 2',
        // ...
    ],
    'notes' => 'Special preparation notes',     // Optional
    'dietary_tags' => ['low-sodium', 'vegetarian']  // Optional
]
```

---

## SECURITY IMPLEMENTATION

### Input Validation
- All user inputs sanitized via `sanitize_input()`
- HTML special characters escaped
- SQL injection prevention with prepared statements

### Output Encoding
- HTML escaping on all dynamic content
- JSON encoding for API responses
- URL encoding for links

### HTTP Security Headers
```
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

### Session Security
- Secure session configuration in production
- HTTP-only cookie flag
- HTTPS enforcement
- Session timeout

---

## TROUBLESHOOTING GUIDE

### Issue: "No menu generated" message
**Solution:**
1. Check browser console for JavaScript errors
2. Verify PHP is enabled on server
3. Check file permissions on data directory
4. Review PHP error log

### Issue: Export button not working
**Solution:**
1. Generate a menu first
2. Check if cookies are enabled
3. Verify data directory is writable
4. Check server disk space

### Issue: Database connection error
**Solution:**
1. Verify MySQL credentials in .env
2. Test MySQL server is running
3. Application will automatically fall back to JSON storage
4. Check data/recipes.json exists and is readable

### Issue: Slow menu generation
**Solution:**
1. If using MySQL, run OPTIMIZE TABLE
2. Increase PHP max_execution_time
3. Check server CPU and memory usage
4. Consider implementing caching layer

---

## MONITORING & MAINTENANCE

### Weekly Tasks
- [ ] Review error logs
- [ ] Test menu generation
- [ ] Verify all export formats work
- [ ] Check disk space usage

### Monthly Tasks
- [ ] Update PHP dependencies (security)
- [ ] Analyze website performance
- [ ] Review access logs for anomalies
- [ ] Update recipe database if needed

### Quarterly Tasks
- [ ] Full security audit
- [ ] Database optimization
- [ ] Backup verification (test restore)
- [ ] User feedback review

---

## FUTURE ENHANCEMENTS

1. **User Authentication**
   - Facility-specific menus
   - User preferences saving
   - Admin dashboard

2. **Advanced Recipe Management**
   - Cost tracking per recipe
   - Nutritional information
   - Allergy warnings

3. **Integration Features**
   - Grocery ordering system
   - Inventory management
   - Kitchen display systems

4. **Analytics**
   - Popular recipe tracking
   - Usage statistics
   - Resident feedback

5. **Mobile App**
   - Native iOS/Android apps
   - Offline menu access
   - Push notifications

---

## COMPLIANCE & CERTIFICATIONS

### Health & Safety
- All recipes include senior-appropriate modifications
- Low-sodium options for hypertension
- Soft texture recommendations
- Allergy and dietary restriction support

### Accessibility
- WCAG 2.1 AA compliance
- Semantic HTML
- Proper contrast ratios
- Keyboard navigation

### Data Privacy
- GDPR-compliant data handling (if EU users)
- No unnecessary data collection
- Secure storage of preferences
- User data deletion option

---

## SUPPORT & DOCUMENTATION

- **README.md** - Project overview and features
- **DEPLOYMENT.md** - Server setup and configuration
- **Database/schema.sql** - Database structure
- **Code Comments** - Inline documentation

---

## VERSION INFORMATION

- **Application Version:** 2.0.0
- **Release Date:** January 2026
- **PHP Minimum Version:** 7.4
- **MySQL Minimum Version:** 5.7
- **Last Updated:** January 20, 2026

---

**Implementation Complete!**

The Assisted Living Menu Generator has been successfully converted from a static HTML application to a dynamic, production-ready PHP application with professional architecture, SEO optimization, and comprehensive features for subdomain deployment at allaround.work/tools/menugen.
